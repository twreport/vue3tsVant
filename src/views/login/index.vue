<template>
    <div class="login-box">
        <svg t="1693295337450" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="10032" width="200" height="200">
            <path
                d="M928.930505 83.078303a183.281521 183.281521 0 0 1-40.989956 114.83179 170.450317 170.450317 0 0 1-108.990346 41.339444 183.381375 183.381375 0 0 1 40.940029-114.83179 170.849732 170.849732 0 0 1 109.040273-41.389371m-372.354559 71.34549a176.341687 176.341687 0 0 1 73.89176 91.665724 128.411897 128.411897 0 0 1 2.696051 48.179425l-8.837055 66.502584-8.43764 8.637348-6.989761-4.992687a176.092053 176.092053 0 0 1-72.094393-90.816967 183.680936 183.680936 0 0 1 19.970746-119.375134M379.635137 335.70824a176.441541 176.441541 0 0 1 74.041541 91.765578 128.312043 128.312043 0 0 1 2.69605 48.179424l-8.787128 66.302877-1.497806 1.497806-7.089615 7.289322-6.939834-4.992686a175.892345 175.892345 0 0 1-72.14432-90.816968 183.730863 183.730863 0 0 1 19.970746-119.375134m361.121014 49.028182a115.181277 115.181277 0 0 1 29.007509 3.694588 176.641248 176.641248 0 0 1 90.916821 78.285324 197.860166 197.860166 0 0 1-87.771429 24.36431 107.392686 107.392686 0 0 1-27.70941-3.644661 172.697026 172.697026 0 0 1-87.871282-73.642126l-6.041151-9.136616 6.490493-6.6902 3.045539-3.095466 63.906387-8.936909a115.630619 115.630619 0 0 1 16.07645-1.148317M202.794181 517.142467A176.441541 176.441541 0 0 1 276.835722 608.908045a128.312043 128.312043 0 0 1 2.696051 48.179425l-8.787128 66.252949-8.587421 8.787129-6.939834-4.992687a175.992199 175.992199 0 0 1-72.14432-90.816967 183.730863 183.730863 0 0 1 19.970746-119.375134m361.170941 49.078108a115.93018 115.93018 0 0 1 29.057435 3.694588 176.591321 176.591321 0 0 1 90.866894 78.235397 197.460751 197.460751 0 0 1-87.821355 24.36431 106.843491 106.843491 0 0 1-27.70941-3.644661A172.846806 172.846806 0 0 1 480.687112 595.028376l-5.941297-9.086689 9.635885-9.985373 63.756606-8.886982a115.331058 115.331058 0 0 1 16.076451-1.098391m-177.140517 181.484154a115.181277 115.181277 0 0 1 29.007508 3.694588 176.691175 176.691175 0 0 1 90.966748 78.385178 197.610531 197.610531 0 0 1-87.721501 24.36431 107.192979 107.192979 0 0 1-27.70941-3.644661 172.94666 172.94666 0 0 1-87.871283-73.642126l-6.091077-9.23647 6.540419-6.6902 3.095466-3.195319 63.756606-8.886982a115.380985 115.380985 0 0 1 16.076451-1.148318m599.122379-747.155534a24.264456 24.264456 0 0 0-17.474403 7.389176l-23.865041 24.414237h-1.947148a227.616577 227.616577 0 0 0-158.168308 56.866699 241.795807 241.795807 0 0 0-55.468747 164.109605l-46.032569 47.180888a179.437153 179.437153 0 0 0-3.794442-66.852072 236.154071 236.154071 0 0 0-110.887567-131.307655l-8.737202-33.451a24.414237 24.414237 0 0 0-23.815114-18.572793 24.064749 24.064749 0 0 0-6.240858 0.798829 25.312921 25.312921 0 0 0-17.424476 30.954657l8.737201 33.401072a243.393467 243.393467 0 0 0-32.00312 170.550171 222.024768 222.024768 0 0 0 92.015212 119.325207l-74.890297 76.737592a179.736714 179.736714 0 0 0-3.794442-66.852073 236.353779 236.353779 0 0 0-110.887567-131.307654l-8.737202-33.401073a24.514091 24.514091 0 0 0-29.956119-17.873818 25.312921 25.312921 0 0 0-17.424475 30.954657l8.737201 33.401072a243.393467 243.393467 0 0 0-32.003121 170.550171 222.47411 222.47411 0 0 0 92.015213 119.325207l-74.890298 76.737592a179.736714 179.736714 0 0 0-3.794442-66.852073A236.353779 236.353779 0 0 0 214.626848 465.218528l-8.737201-33.401073a24.514091 24.514091 0 0 0-11.383325-15.277621 24.114676 24.114676 0 0 0-12.481716-3.444953 24.963432 24.963432 0 0 0-6.340712 0.848756 25.312921 25.312921 0 0 0-17.424476 30.90473l8.787128 33.450999a243.093905 243.093905 0 0 0-32.053047 170.550171 223.123159 223.123159 0 0 0 92.115066 119.325207l-103.098977 105.7451a623.137201 623.137201 0 0 1-45.633154-140.494198 573.859386 573.859386 0 0 1 55.318966-386.83335 25.562555 25.562555 0 0 0-9.985373-34.199902A24.414237 24.414237 0 0 0 112.077068 309.446709a24.963432 24.963432 0 0 0-7.189469 1.048464 24.36431 24.36431 0 0 0-14.528717 12.232082 633.222428 633.222428 0 0 0-59.912238 422.830619 656.887762 656.887762 0 0 0 56.716918 166.056753L20.161709 980.264066a25.712335 25.712335 0 0 0 0 35.747636 24.214529 24.214529 0 0 0 34.948806 0l66.652365-68.250025a667.622038 667.622038 0 0 0 151.977376 53.521599 650.696831 650.696831 0 0 0 142.091858 15.77689 627.430912 627.430912 0 0 0 281.737299-66.702292 24.514091 24.514091 0 0 0 11.033837-33.201365 25.662409 25.662409 0 0 0-22.566943-13.480254 26.11175 26.11175 0 0 0-11.433252 2.696051 572.411507 572.411507 0 0 1-257.522769 61.809459 606.11214 606.11214 0 0 1-130.209264-14.478791 631.674695 631.674695 0 0 1-128.561677-43.336519l0.599122-0.599122 103.148903-105.7451a219.12901 219.12901 0 0 0 116.379522 94.361775 155.27255 155.27255 0 0 0 40.94003 5.442028h0.649049a257.522769 257.522769 0 0 0 124.817162-38.194052l32.602243 8.886982a25.262994 25.262994 0 0 0 6.390639 0.848757 24.963432 24.963432 0 0 0 23.815114-18.722574 25.362847 25.362847 0 0 0-17.474403-30.954657l-32.652169-8.986835a234.656265 234.656265 0 0 0-128.112336-113.683472 165.657338 165.657338 0 0 0-42.238127-5.491955 168.603023 168.603023 0 0 0-22.966358 1.59766l74.890297-76.737592a218.729595 218.729595 0 0 0 116.379522 94.361775 157.369478 157.369478 0 0 0 40.94003 5.442028h0.748903a256.923647 256.923647 0 0 0 124.817162-38.243978l32.602243 8.986836a23.265919 23.265919 0 0 0 6.390638 0.898683 24.963432 24.963432 0 0 0 23.815115-18.772501 25.362847 25.362847 0 0 0-17.474403-30.954656l-32.602243-8.936909a234.656265 234.656265 0 0 0-128.062408-113.683472 166.006826 166.006826 0 0 0-42.288055-5.442028 160.914286 160.914286 0 0 0-22.966358 1.59766l74.890298-76.787519a219.12901 219.12901 0 0 0 116.379522 94.361775 155.27255 155.27255 0 0 0 40.940029 5.442028h0.64905a257.023501 257.023501 0 0 0 124.817162-38.194051l32.65217 8.936909a24.464164 24.464164 0 0 0 29.956119-17.873818 25.362847 25.362847 0 0 0-17.424476-30.954656l-32.602243-8.936909a234.656265 234.656265 0 0 0-128.112336-113.683472 165.657338 165.657338 0 0 0-42.238127-5.491955 168.003901 168.003901 0 0 0-22.966358 1.59766l46.032569-47.180887h1.947148a227.317016 227.317016 0 0 0 158.118381-56.916626 241.945588 241.945588 0 0 0 55.468747-164.059679l23.865042-24.414237a25.712335 25.712335 0 0 0 0-35.797562 24.264456 24.264456 0 0 0-17.424476-7.389176z"
                p-id="10033" fill="#bfbfbf"></path>
        </svg>
        <van-form @submit="onSubmit" class="login-form">
            <van-cell-group inset>
                <van-field v-model="username" name="用户名" label="用户名" placeholder="用户名"
                    :rules="[{ required: true, message: '请填写用户名' }]" />
                <van-field v-model="password" type="password" name="密码" label="密码" placeholder="密码"
                    :rules="[{ required: true, message: '请填写密码' }]" />
            </van-cell-group>
            <div style="margin: 16px;">
                <van-button round block type="primary" native-type="submit">
                    提交
                </van-button>
            </div>
        </van-form>
        <van-floating-bubble icon="user-o" @click="goRegister" />
    </div>
</template> 
  
<script lang="ts" setup>
import { ref } from 'vue'
import loginApi from '@/api/login'
import { onMounted } from 'vue'
import { useRouter } from 'vue-router';
import { useUserStore } from '@/store/user';
import { useMenuStore } from '@/store/menu';

const router = useRouter()
const userStore = useUserStore()
const menuStore = useMenuStore()

const username = ref('');
const password = ref('');


const onSubmit = () => {
    

    loginApi
        .login(username.value, password.value)
        .then(res => {
            console.log(res);
            if ('err' in res) {

            } else {
                sessionStorage.clear();
                userStore.setUserLogin(res.data);
                menuStore.setUserMenu(res.data.user_menu);
                menuStore.setUserPermission(res.data.user_permission);

                //务必使用location.replace
                //否则会导致闪屏
                //或者sessionStorage无法正常加载
                location.replace('/home')
            }
        });
};

const goRegister = () => {
    console.log('register!');
    router.push('/register');
}

onMounted(() => {
    console.log(`the component Login is now mounted.`)
})


</script>

<style scoped>
.login-box {
    width: 300px;
    margin: 0 auto;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
}

.login-form {
    margin-top: 2em;
}

.icon {
    text-align: center;
    margin-top: 10em;
    opacity: 0.4;
}
</style>
  